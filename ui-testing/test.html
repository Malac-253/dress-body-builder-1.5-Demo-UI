<!-- templates/load_script.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Load Protected Script</title>
</head>
<body>
    <h1>Protected JavaScript Loader</h1>
    <div id="content"></div>

    <script>
        async function loadProtectedScript(scriptName, accessCode = null) {
            try {
                // Construct the API URL
                let url = `/api/scripts/${encodeURIComponent(scriptName)}/`;

                // Append access code as a query parameter if provided
                if (accessCode) {
                    url += `?access_code=${encodeURIComponent(accessCode)}`;
                }

                // Set up fetch options
                const fetchOptions = {
                    method: 'GET',
                    headers: {}
                };

                // If using access codes via headers, add them
                if (!accessCode) {
                    // Replace with actual token retrieval logic
                    const token = 'YOUR_AUTH_TOKEN';
                    fetchOptions.headers['Authorization'] = `Bearer ${token}`;
                }

                // Fetch the script
                const response = await fetch(url, fetchOptions);

                if (!response.ok) {
                    throw new Error(`Failed to load script: ${response.status} ${response.statusText}`);
                }

                // Get the script content
                const scriptContent = await response.text();

                // Create a new script element
                const script = document.createElement('script');
                script.type = 'application/javascript';
                script.text = scriptContent;

                // Append the script to the body
                document.body.appendChild(script);

                console.log(`Script "${scriptName}" loaded successfully.`);
            } catch (error) {
                console.error(error);
            }
        }

        // Example Usage:
        // Using access codes
        // loadProtectedScript('script1.js', 'YOUR_ACCESS_CODE');

        // Using user authentication
        loadProtectedScript('script2.js');
    </script>
</body>
</html>
